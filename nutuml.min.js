"use strict";var NutUml;!function(){var v=14,s=v+"px Arial",f=5,u=10,p=5,d=10,c=v+f,g="#9A6A7A",r="#FEFECE",y="#ffffff",h="#333",m="#A80036";const l="#F6FF70",n="#BA0028";var w=13;const x=12,X=8,T="bold "+x+"px Courier";var b="28px Arial";const O=2,S=3,H=8,k=13,P=15,Y=40,M=3,I=5,B=8,W=9,R=20,E=15,C=10,N=5,L=10,F=10,A=["actor","boundary","control","entity","database"],_={actor:{width:34,height:54},boundary:{width:42,height:26},control:{width:26,height:32},entity:{width:24,height:26},database:{width:38,height:50}},U=["hide","autonumber","as","participant","actor","boundary","control","entity","database","collections","title","header","footer","alt","else","opt","loop","par","break","critical","group","end","note","left","right","of","over","ref","activate","deactivate","destroy"],z=["participant","actor","boundary","control","entity","database","collections"],D=["title","header","footer","alt","else","opt","loop","par","break","critical","group"],j=["title","note","ref"],Q=["activate","deactivate","destroy"],q=["opt","loop","par","break","critical","group"],G=["-",">","<","->","--\x3e","<-","<--"],J=["->","--\x3e"],K=["<--","--\x3e"],e=[":"],V=["\r","\n"];function Z(e,t){var i=t.cornerY+X,a=t.height-X;t.type==B&&(e.save(),e.beginPath(),e.fillStyle="#fff",e.fillRect(t.x,i,t.width,a),e.fill(),e.restore()),e.save(),e.beginPath(),e.lineWidth=2,e.moveTo(t.toX,i),e.lineTo(t.x,i),e.lineTo(t.x,t.toY),e.stroke(),e.restore(),e.save(),e.beginPath(),e.lineWidth=2,e.shadowBlur=3,e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowColor=g,e.moveTo(t.toX,i),e.lineTo(t.toX,t.toY),e.lineTo(t.x,t.toY),e.stroke(),e.restore(),e.beginPath();var o=t.typeName;"group"==o&&""!=t.message&&(o=t.message,t.message=""),e.font=T;var l,n=fe(e,o,x),r=(r=Math.max(n.width,Y))+k+P,h=n.height,a=t.x+1,n=i+1;e.save(),e.beginPath(),e.fillStyle="#fff",e.moveTo(a,n),e.lineTo(a+r,n),e.lineTo(a+r,n+h/2),e.lineTo(a+r-h/2,n+h),e.lineTo(a,n+h),e.closePath(),e.fill(),e.restore(),e.save(),e.beginPath(),e.moveTo(t.x,i),e.lineTo(t.x+r,i),e.lineTo(t.x+r,i+h/2),e.lineTo(t.x+r-h/2,i+h),e.lineTo(t.x,i+h),e.stroke(),e.beginPath(),e.restore(),t.type!=M&&t.type!=I||""==t.message||(l="["+t.message+"]",ue(e,t.x+r+u,i-2,l,!0)),t.type==B&&(e.font=s,r=fe(e,t.message,v),l=t.x+(t.width-r.width)/2,console.log("item.x=",t.x,",txtX=",l,"item.width=",t.width,"txtwidth=",r.width),ve(e,l,n+h+f,t.message,!1)),ue(e,t.x+u,i-2,o,!0)}function $(e,t){var i=t.cornerY+E,a=t.noteHeight-E-N,o=t.noteItem.color||l;e.save(),e.beginPath(),e.lineWidth=1,e.fillStyle=o,e.strokeStyle=n,e.moveTo(t.noteX,i+a),e.lineTo(t.noteX,i),e.lineTo(t.noteX+t.noteWidth-10,i),e.lineTo(t.noteX+t.noteWidth,i+10),e.lineTo(t.noteX+t.noteWidth,i+a),e.closePath(),e.stroke(),e.fill(),e.restore(),e.save(),e.beginPath(),e.lineWidth=1,e.strokeStyle=n,e.moveTo(t.noteX+t.noteWidth-10,i),e.lineTo(t.noteX+t.noteWidth-10,i+10),e.lineTo(t.noteX+t.noteWidth,i+10),e.closePath(),e.stroke(),e.restore(),e.save(),e.beginPath(),e.lineWidth=1,e.shadowBlur=3,e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowColor=g,e.strokeStyle=n,e.moveTo(t.noteX+t.noteWidth,i+10),e.lineTo(t.noteX+t.noteWidth,i+a),e.lineTo(t.noteX,i+a),e.stroke(),e.restore(),e.beginPath(),ve(e,t.noteX+C,i,t.noteItem.message,!1)}function ee(e,t){e.font=s;for(var i,a,o=t.length,l=0;l<o;l++){var n=t[l];a=void 0,a=u,i=fe(i=e,(n=n).title),n.width=i.width+2*a,n.height=i.height,"collections"==n.type&&(n.width+=4,n.height+=4),A.includes(n.type)&&(n.width=i.width,n.height+=_[n.type].height,n.width<_[n.type].width&&(n.width=_[n.type].width))}}function te(e){for(var t,i,a=[],o=d+e.headerHeight+e.titleHeight+e.maxParticipantHeight,l=0,n=0,r=0;r<e.lines.length;r++){var h=e.lines[r];if(h.cornerY=o,h.lineY=h.cornerY+(h.height-h.lineHeight)/2,o+=h.height,h.y=o,h.toY=o,h.type==M||h.type==I?(0==a.length&&(i=void 0),a.push(h),t=h):6==h.type?(null!=(t=a.pop())&&(t.toY=o,void 0!==i&&(null==t.x?t.x=i.x-10:t.x=Math.min(t.x,i.x-10),null==t.toX?t.toX=i.toX+20:t.toX=Math.max(t.toX,i.toX+20),l=Math.min(l,t.x),n=Math.max(n,t.toX))),i=t,0<a.length&&(t=a[a.length-1])):4==h.type?h.refItem=t:7==h.type?(h.noteX=function(e,t){for(var i,a,o=0;o<t.participant.length;o++)t.participant[o].name==e.noteItem.participant&&(i=t.participant[o]),t.participant[o].name==e.noteItem.participantTo&&(a=t.participant[o]);return void 0!==a?(a.lineX+i.lineX)/2-e.noteWidth/2:"left"==e.noteItem.direction?i.lineX-e.noteWidth-L:"right"==e.noteItem.direction?i.lineX+L:i.lineX-e.noteWidth/2}(h,e),l=Math.min(l,h.noteX),n=Math.max(n,h.noteX+h.noteWidth+d)):h.type==B&&(h.x=function(e,t){for(var i,a,o=0;o<t.participant.length;o++)t.participant[o].name==e.from&&(i=t.participant[o]),t.participant[o].name==e.to&&(a=t.participant[o]);if(null==i)return 0;{if(void 0===a)return i.lineX-20;var l=Math.abs(a.lineX-i.lineX)+R;return e.width=Math.max(e.width,l),(a.lineX+i.lineX)/2-e.width/2}}(h,e),h.toX=h.x+h.width,h.toY=h.cornerY+h.height,l=Math.min(l,h.x),n=Math.max(n,h.toX+d)),1===h.type){for(var s,f,u=0;u<e.participant.length;u++)e.participant[u].name==h.from&&(s=e.participant[u]),e.participant[u].name==h.to&&(f=e.participant[u]);h.x=s.lineX,h.toX=f.lineX,null!=h.noteItem&&("left"==h.noteItem.direction?(h.noteX=Math.min(h.x,h.toX)-h.noteWidth-L,l=Math.min(l,h.noteX)):"right"==h.noteItem.direction&&(h.noteX=Math.max(h.x,h.toX)+L,n=Math.max(n,h.noteX+h.noteWidth+d))),null!=t&&(null==t.x?t.x=h.x-30:t.x=Math.min(h.x-30,t.x),null==t.toX?t.toX=h.toX+20:t.toX=Math.max(h.toX+20,t.toX))}}n+d>e.width&&(e.width=n+d),l<0&&(e.tranlateX=Math.ceil(Math.abs(l)),e.width+=e.tranlateX)}function ie(e,t,i,a,o){e.save(),e.beginPath(),e.setLineDash([5,5]),e.moveTo(t,i),e.lineTo(a,o),e.stroke(),e.fill(),e.restore()}function ae(e,t,i,a,o){e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(a,o),e.stroke(),e.fill(),e.restore()}function oe(e,t){var i,a,o,l;"actor"==t.type?function(e,t){var i=t.x+2,a=t.y;t.isBottom&&(a+=v+p);var o=_.actor.width,l=_.actor.height;t.width>o&&(i=t.x+(t.width-o)/2),e.save(),e.beginPath(),e.lineWidth=2,e.strokeStyle=m,e.fillStyle=r,e.arc(i+15,a+8,8,0,2*Math.PI),e.fill(),e.moveTo(i+15,a+16),e.lineTo(i+15,a+40),e.moveTo(i+2,a+22),e.lineTo(i+28,a+22),e.moveTo(i,a+54),e.lineTo(i+15,a+40),e.lineTo(i+30,a+54),e.stroke(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=h,i=t.x;var n=e.measureText(t.title).width;n<o&&(i+=(o-n)/2),t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+l+t.y),e.fill(),e.stroke(),e.restore()}(e,t):"boundary"==t.type?function(e,t){var i=t.x+1,a=t.y;t.isBottom&&(a+=v+p);var o=_.boundary.width,l=_.boundary.height;t.width>o&&(i=t.x+(t.width-o)/2),e.save(),e.beginPath(),e.lineWidth=2,e.strokeStyle=m,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.moveTo(i,a),e.lineTo(i,a+24),e.moveTo(i,a+12),e.lineTo(i+17,a+12),e.stroke(),e.beginPath(),e.lineWidth=2,e.arc(i+29,a+12,12,0,2*Math.PI),e.stroke(),e.beginPath(),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.arc(i+29,a+12,11,0,2*Math.PI),e.fill(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=h,i=t.x;var n=e.measureText(t.title).width;n<o&&(i+=(o-n)/2),e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+l+t.y),e.fill(),e.stroke(),e.restore()}(e,t):"control"==t.type?function(e,t){var i=t.x,a=t.y;t.isBottom&&(a+=v+p);var o=_.control.width,l=_.control.height;t.width>o&&(i=t.x+(t.width-o)/2),e.save(),e.lineWidth=2,e.strokeStyle=m,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.beginPath(),e.lineWidth=2,e.arc(i+13,a+19,13,0,2*Math.PI),e.stroke(),e.beginPath(),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.arc(i+13,a+19,12,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle=m,e.moveTo(i+10,a+6),e.lineTo(i+17,a+12),e.lineTo(i+15,a+6),e.lineTo(i+17,a),e.closePath(),e.fill(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=h,i=t.x;var n=e.measureText(t.title).width;n<o&&(i+=(o-n)/2),e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+l+t.y),e.fill(),e.stroke(),e.restore()}(e,t):"entity"==t.type?function(e,t){var i=t.x,a=t.y;t.isBottom&&(a+=v+p);var o=_.entity.width,l=_.entity.height;t.width>o&&(i=t.x+(t.width-o)/2),e.save(),e.lineWidth=2,e.strokeStyle=m,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.beginPath(),e.lineWidth=2,e.arc(i+12,a+12,12,0,2*Math.PI),e.stroke(),e.beginPath(),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.arc(i+12,a+12,11,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle=m,e.moveTo(i,a+25),e.lineTo(i+25,a+25),e.stroke(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=h,i=t.x;var n=e.measureText(t.title).width;n<o&&(i+=(o-n)/2),e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+l+t.y),e.fill(),e.stroke(),e.restore()}(e,t):"database"==t.type?function(e,t){var i=t.x,a=t.y;t.isBottom&&(a+=v+p);var o=_.database.width,l=_.database.height;t.width>o&&(i=t.x+(t.width-o)/2),e.save(),e.lineWidth=2,e.strokeStyle=m,e.fillStyle=r,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor=g,e.beginPath(),e.fillRect(t.x,a+11,38,28),e.fill(),e.lineWidth=2,e.ellipse(i+19,a+11,19,11,0,0,2*Math.PI),e.ellipse(i+19,a+39,19,11,0,0,Math.PI),e.moveTo(i,a+11),e.lineTo(i,a+39),e.moveTo(i+38,a+11),e.lineTo(i+38,a+39),e.fill(),e.stroke(),e.beginPath(),e.strokeStyle=m,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=2,e.shadowOffsetY=3,e.shadowColor=g,e.moveTo(i+38,a+11),e.lineTo(i+38,a+39),e.ellipse(i+19,a+39,19,11,0,0,Math.PI),e.stroke(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=h,i=t.x;var n=e.measureText(t.title).width;n<o&&(i+=(o-n)/2),e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+l+t.y),e.fill(),e.stroke(),e.restore()}(e,t):"collections"==t.type?(i=e,o=(a=t).height-4,l=a.width-4,i.save(),i.beginPath(),i.shadowBlur=3,i.shadowOffsetX=4,i.shadowOffsetY=4,i.shadowColor=g,i.fillStyle=r,i.fillRect(a.x+4,a.y,l,o),i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=1,i.fillRect(a.x+4,a.y,l,o),i.strokeStyle=m,i.strokeRect(a.x+4,a.y,l,o),i.stroke(),i.fill(),i.beginPath(),i.shadowBlur=3,i.shadowOffsetX=4,i.shadowOffsetY=4,i.fillRect(a.x,a.y+4,l,o),i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=1,i.fillRect(a.x,a.y+4,l,o),i.strokeStyle=m,i.strokeRect(a.x,a.y+4,l,o),i.stroke(),i.fill(),i.restore(),ve(i,a.x+u,a.y+4,a.title,!0)):(t=t,(e=e).save(),e.beginPath(),e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.fillStyle=r,e.fillRect(t.x,t.y,t.width,t.height),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1,e.fillRect(t.x,t.y,t.width,t.height),e.strokeStyle=m,e.strokeRect(t.x,t.y,t.width,t.height),e.stroke(),e.fill(),e.restore(),ve(e,t.x+u,t.y,t.title,!0))}function le(e,t){var i,a,o,l,n;0<t.titleHeight&&(e.font=b,o=fe(e,t.title,28),l=(t.width-o.width)/2,i=e,a=l,o=d+t.headerHeight,l=t.title,i.save(),i.font=b,i.fillStyle=h,pe(i,a,o,l,v),i.fill(),i.restore()),0<t.headerHeight&&(e.font=s,n=fe(e,t.header),ve(e,t.width-d-n.width,d,t.header,!1)),0<t.footerHeight&&(e.font=s,n=fe(e,t.footer),ve(e,t.width-d-n.width,t.height-t.footerHeight,t.footer,!1))}function ne(e,t){for(var i=t.participant.length,a=function(e){for(var t=e.lines.length,i=[],a=0;a<t;a++){var o=e.lines[a];o.type==W&&i.push({from:o.cornerY,to:o.cornerY+o.height})}return i}(t),o=0;o<i;o++){var l=t.participant[o];oe(e,l);var n=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}(l);n.y=l.y+t.innerHeight+c+l.height,n.isBottom=!0,t.hideFootbox||oe(e,n),0<a.length?function(e,t,i,a,o,l){ae(e,t,i,a,l[0].from+10);for(var n,r,h,s,f,u=0;u<l.length;u++)1<=u&&ae(e,t,l[u-1].to+10,a,l[u].from+10),n=e,r=t,h=l[u].from+10,s=a,f=l[u].to+10,n.save(),n.beginPath(),n.setLineDash([1,4]),n.moveTo(r,h),n.lineTo(s,f),n.stroke(),n.fill(),n.restore();ae(e,t,l[l.length-1].to+10,a,o)}(e,l.lineX,l.lineY,l.lineX,n.y,a):ie(e,l.lineX,l.lineY,l.lineX,n.y)}}function re(e,t){for(var i=0;i<t.activeLines.length;i++)!function(e,t){e.save(),e.beginPath(),e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g;var i=t.x-F/2,a=t.topY,o=F,t=t.bottomY-t.topY;e.fillStyle="#ffffff",e.fillRect(i,a,o,t),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1,e.fillRect(i,a,o,t),e.strokeStyle=m,e.strokeRect(i,a,o,t),e.stroke(),e.fill(),e.restore()}(e,t.activeLines[i])}function he(e,t){for(var i,a,o,l,n=t.lines.length,r=0;r<n;r++){var h=t.lines[r];1==h.type?function(e,t,i){null!=t.noteItem&&$(e,t);var a=t.message;if(i.autonumber&&(a=t.number+" "+a),fe(e,t.message),t.from==t.to)return ve(e,Math.min(t.x,t.toX)+10,t.lineY+p,a),function(e,t,i){e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(t+40,i),e.lineTo(t+40,i+13),e.lineTo(t,i+13),e.stroke(),e.restore(),se(e,t,i+13,!0)}(e,t.x,t.lineY+t.lineHeight-w),0;ve(e,Math.min(t.x,t.toX)+10,t.lineY+p,a),(K.includes(t.operator)?ie:ae)(e,t.x,t.lineY+t.lineHeight,t.toX,t.lineY+t.lineHeight),se(e,t.toX,t.lineY+t.lineHeight,t.x>t.toX)}(e,h,t):2==h.type?function(e,t,i){e.save(),e.beginPath();var a=t.y-t.height/2+p,o=i.width/2-t.width/2,l=fe(e,t.message),n=a-l.height/2,r=l.height,l=a-2,a=a+2;e.fillStyle=y,e.fillRect(0,l,i.width,4),e.fill(),e.moveTo(0,l),e.lineTo(i.width,l),e.moveTo(i.width,a),e.lineTo(0,a),e.stroke(),e.beginPath(),e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.fillStyle=y,e.fillRect(o,n,t.width,r),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1,e.fillRect(o,n,t.width,r),e.strokeStyle=m,e.strokeRect(o,n,t.width,r),e.stroke(),e.restore(),ve(e,o+u,n-2,t.message)}(e,h,t):4==h.type?(i=e,l=o=void 0,o="["+(a=h).message+"]",l=fe(i,a.message),ue(i,Math.min(a.refItem.x,a.refItem.toX)+10,a.y-l.height,o),o=a.cornerY+7,ie(i,a.refItem.x,o,a.refItem.toX,o)):7==h.type?$(e,h):h.type==B?Z(e,h):h.type==W&&(i=e,a=h,o=t.width,h=void 0,""!=a.message.trim()&&(h=fe(i,a.message,v),h=(o-h.width)/2-C,ve(i,h,a.lineY+20,a.message)))}}function se(e,t,i,a){var o=-12,l=-7,n=-5;a&&(o=0-o,l=0-l,n=0-n),e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(t+o,i+n),e.lineTo(t+l,i),e.lineTo(t+o,i-n),e.lineTo(t,i),e.stroke(),e.fill(),e.restore()}function fe(t,e,i){i=i||v;var a={width:0,height:0},e=e.split("\n");return e.forEach(function(e){a.width=Math.max(a.width,t.measureText(e).width)}),a.height=e.length*(i+p)+p,a}function ue(e,t,i,a,o){e.save(),e.font=T,e.fillStyle=h,pe(e,t,i,a,v,o),e.fill(),e.restore()}function ve(e,t,i,a,o){e.save(),e.font=s,e.fillStyle=h,pe(e,t,i,a,v,o),e.fill(),e.restore()}function pe(e,t,i,a,o,l){var n=o||v,r=a.split("\n"),h=null;l&&(h=fe(e,a));for(var s=0;s<r.length;s++){var f=t,u=i+s*(n+p);l&&(f=t+(h.width-e.measureText(r[s]).width)/2),e.fillText(r[s],f,n+u+p-1)}}function de(e,t,i){return{from:"",to:"",message:t,operator:"",number:0,type:e,typeName:i,active:[]}}function ce(e){for(var t,i={participant:[],lines:[],activeLines:[],innerHeight:0,width:0,height:0,title:"",header:"",footer:"",headerHeight:0,titleHeight:0,footerHeight:0,autonumber:!1,hideFootbox:!1},a=e.length,o=0,l=[],n=1;o<a;){var r=e[o++];if(1==r.type){if("ref"==r.value){o=function(e,t,i){var a=e.length;if(i+5<a){var o=e[i+1],l=e[i+3],n=e[i+5];if("over"==e[i].value&&o.type==O&&e[i+2].type==H&&l.type==O&&":"==e[i+4].value&&n.type==S)return(r=de(B,n.value,"REF")).from=o.value,r.to=l.value,t.lines.push(r),i+6}if(i+3<a){o=e[i+1],n=e[i+3];if("over"==e[i].value&&o.type==O&&":"==e[i+2].value&&n.type==S)return(r=de(B,n.value,"REF")).from=o.value,t.lines.push(r),i+4}if(i+4<a){o=e[i+1],n=e[i+2];if("over"==e[i].value&&o.type==O&&n.type==S&&"end"==e[i+3].value&&"ref"==e[i+4].value)return(r=de(B,n.value,"REF")).from=o.value,t.lines.push(r),i+5}if(i+6<a){var r,o=e[i+1],l=e[i+3],n=e[i+4];if("over"==e[i].value&&o.type==O&&e[i+2].type==H&&o.type==O&&n.type==S&&"end"==e[i+5].value&&"ref"==e[i+6].value)return(r=de(B,n.value,"REF")).from=o.value,r.to=l.value,t.lines.push(r),i+7}}(e,i,o);continue}if("note"==r.value){if(o+2<a){var h=e[o],s=e[o+1],f=e[o+2];if(("left"==h.value||"right"==h.value)&&":"==s.value&&f.type==S){var u={direction:h.value,message:f.value};o+=3,0<i.lines.length&&(i.lines[i.lines.length-1].noteItem=u);continue}}if(o+3<a){h=e[o],f=e[o+1];if(("left"==h.value||"right"==h.value)&&f.type==S&&"end"==e[o+2].value&&"note"==e[o+3].value){u={direction:h.value,message:f.value};o+=4,0<i.lines.length&&(i.lines[i.lines.length-1].noteItem=u);continue}}if(o+6<a){var h=e[o],v=e[o+1],p=e[o+2],d=e[o+3],f=e[o+4];if(("left"==h.value||"right"==h.value)&&"of"==v.value&&p.type==O&&f.type==S&&"end"==e[o+5].value&&"note"==e[o+6].value){u={direction:h.value,message:f.value,color:d.value,participant:p.value};o+=7,(w=de(7,"","ONLY_NOTE")).noteItem=u,i.lines.push(w);continue}}if(o+4<a){var h=e[o],v=e[o+1],p=e[o+2],c=e[o+3],f=e[o+4];if(("left"==h.value||"right"==h.value)&&"of"==v.value&&p.type==O&&5==c.type&&f.type==S){u={direction:h.value,message:f.value,participant:p.value};o+=5,(w=de(7,"","ONLY_NOTE")).noteItem=u,i.lines.push(w);continue}}if(o+3<a){var g=e[o],p=e[o+1],c=e[o+2],f=e[o+3];if("over"==g.value&&p.type==O&&5==c.type&&f.type==S){u={direction:g.value,message:f.value,participant:p.value};o+=4,(w=de(7,"","ONLY_NOTE")).noteItem=u,i.lines.push(w);continue}}if(o+6<a){var g=e[o],p=e[o+1],y=e[o+2],m=e[o+3],d=e[o+4],c=e[o+5],f=e[o+6];if("over"==g.value&&p.type==O&&y.type==H&&m.type==O&&5==c.type&&f.type==S){u={direction:g.value,message:f.value,participant:p.value,color:d.value,participantTo:m.value};o+=7,(w=de(7,"","ONLY_NOTE")).noteItem=u,i.lines.push(w);continue}}if(o+6<a){g=e[o],p=e[o+1],y=e[o+2],m=e[o+3],f=e[o+4];if("over"==g.value&&p.type==O&&y.type==H&&m.type==O&&f.type==S&&"end"==e[o+5].value&&"note"==e[o+6].value){var w,u={direction:g.value,message:f.value,participant:p.value,participantTo:m.value};o+=7,(w=de(7,"","ONLY_NOTE")).noteItem=u,i.lines.push(w);continue}}}if("autonumber"==r.value){i.autonumber=!0;continue}if("title"==r.value&&(b=e[o++]).type==S&&(i.title=b.value),t=r.value,Q.includes(t)){T=i,s=e,k=o,P=r.value,t=Y=void 0,Y=s[k++],o=void 0!==(t=s[k])&&(void 0!==(s=t.value)&&"#"===s[0])?(0<T.lines.length&&T.lines[T.lines.length-1].active.push({type:P,participant:Y.value,color:t.value}),k+1):(Y.type==O&&0<T.lines.length&&T.lines[T.lines.length-1].active.push({type:P,participant:Y.value}),k);continue}if("header"==r.value&&(b=e[o++]).type==S&&(i.header=b.value),"footer"==r.value&&(b=e[o++]).type==S&&(i.footer=b.value),"hide"==r.value){"footbox"==e[o].value&&(i.hideFootbox=!0,o++);continue}if("alt"==r.value){var x="";o<a&&(X=e[o]).type==S&&(x=X.value,o++),i.lines.push(de(M,x,r.value));continue}if("else"==r.value){x="";o<a&&(X=e[o]).type==S&&(x=X.value,o++),i.lines.push(de(4,x,r.value));continue}if("end"==r.value){i.lines.push(de(6,"",r.value));continue}if(q.includes(r.value)){var X,x="";o<a&&(X=e[o]).type==S&&(x=X.value,o++),i.lines.push(de(I,x,r.value));continue}z.includes(r.value)&&(b=e[o++]).type==O&&(i.participant.push({name:b.value,title:b.value,type:r.value}),l.push(b.value))}if(9!=r.type)if(10!=r.type){if(r.type==O||6==r.type||7==r.type){var T=de(1,"","SEQUENCE");if(7!=r.type){if(l.includes(r.value)||(i.participant.push({name:r.value,title:r.value,type:"participant"}),l.push(r.value)),a<=o)break;var b=e[o++];if(a<=o)break;T.operator=b.value;var k,P=e[o++],Y={name:P.value,title:P.value,type:"participant"};o<a&&(1==(k=e[o]).type&&"as"==k.value&&(o++,(P=e[o++]).type==O?Y.name=P.value:6==P.type&&(Y.title=P.value),o<a&&(k=e[o])),5!=k.type||(k=e[++o]).type==S&&(T.message=k.value)),l.includes(Y.name)||(i.participant.push(Y),l.push(Y.name)),J.includes(b.value)?(T.from=r.value,T.to=Y.name):(T.from=Y.name,T.to=r.value),T.number=n++,i.lines.push(T)}else T.type=2,T.message=r.value,i.lines.push(T)}}else i.lines.push(de(10,r.value,"SPACE"));else i.lines.push(de(W,r.value,"DELAY"))}return i}function ge(e,t){var i=t[e.from],t=t[e.to];""===e.from&&""===e.to||(e.from===e.to&&void 0!==i&&0<i.length&&(e.x+=i.length*F/2,e.toX+=t.length*F/2),e.x<e.toX?(void 0!==i&&0<i.length&&(e.x+=i.length*F/2),void 0!==t&&0<t.length&&(e.toX=e.toX+(t.length-2)*F/2)):e.x>e.toX&&(void 0!==i&&0<i.length&&(e.x+=i.length*F/2),void 0!==t&&0<t.length&&(e.toX+=F/2)))}function ye(e,t,i,a){var o=e.active[i],l=t[o.participant],i=function(e,t){for(var i=0;i<e.participant.length;i++)if(t==e.participant[i].name)return e.participant[i]}(a,o.participant);if(void 0!==i){a=e.y;if("activate"==o.type)void 0===l?((l=[]).push({x:i.lineX,topY:a}),t[o.participant]=l):(i=l[l.length-1].x+F/2,l.push({x:i,topY:a})),ge(e,t);else{ge(e,t);l=l.pop();if(void 0!==l)return l.bottomY=a,l.type=o.type,l}}else console.log("undefined"+o.participant)}function me(e){var t=/[a-z0-9]/i.test(e);return t||"#"==e||255<e.charCodeAt(0)}(NutUml=function(e){(this.el=e).innerHTML="";var t=document.createElement("canvas");this.context=t.getContext("2d");var i=document.createElement("img");e.appendChild(i),this.img=i,this.canvas=t,this.tokens=[],this.debug=!1}).prototype.drawUml=function(e){var t=this.analysis(e);if(this.debug&&console.log(t),!(t instanceof Array))return t;this.tokens=t;var i=ce(this.tokens);this.debug&&console.log(i);var a,o=this.context;return o.lineWidth=1,e=o,0<(t=i).title.length&&(a=fe(e,t.title,28),t.titleHeight=a.height),0<t.header.length&&(a=fe(e,t.header),t.headerHeight=a.height),0<t.footer.length&&(e=fe(e,t.footer),t.footerHeight=e.height),ee(o,i.participant),function(e,t){e.font=s;for(var i=t.length,a=u,o=0;o<i;o++){var l,n=t[o],r=fe(e,n.message);n.width=r.width+2*a,n.type==M||n.type==I?n.height=r.height+f:n.type==B?(n.height=r.height+f+36,n.width=Math.max(n.width,100)):6==n.type?n.height=10:10==n.type?(l=parseInt(n.message),n.height=0<l?l:r.height):n.type==W?""==n.message.trim()?n.height=25:n.height=40:n.height=r.height+f,n.from==n.to&&1==n.type&&(n.height+=w),n.lineHeight=n.height,null!=n.noteItem&&(r=fe(e,n.noteItem.message),n.noteWidth=r.width+C+15,n.noteHeight=r.height+E+N,n.height=Math.max(n.lineHeight,n.noteHeight))}}(o,i.lines),function(e){e.innerHeight=0;for(var t=e.participant.length,i=[],a=e.maxParticipantHeight=0;a<e.lines.length;a++){var o=(u=e.lines[a]).from+"_"+u.to;(void 0===i[o]||i[o]<u.width)&&(i[o]=u.width),i[o]<100&&(i[o]=100),e.innerHeight+=u.height}for(var l=0;l<t;l++)e.maxParticipantHeight=Math.max(e.participant[l].height,e.maxParticipantHeight);for(var n=d+e.titleHeight+e.headerHeight,l=0;l<t;l++){var r,h,s,f,u=e.participant[l];0!=l?(h=(r=e.participant[l-1]).name+"_"+u.name,s=u.name+"_"+r.name,f=100,void 0!==i[h]&&(f=Math.max(f,i[h])),void 0!==i[s]&&(f=Math.max(f,i[s])),u.x=r.x+f,u.y=n+e.maxParticipantHeight-u.height,u.lineX=u.x+u.width/2,u.lineY=u.y+u.height):(u.x=d,u.y=n+e.maxParticipantHeight-u.height,u.lineX=u.x+u.width/2,u.lineY=u.y+u.height)}e.height=Math.ceil(e.titleHeight+e.footerHeight+e.headerHeight+c+e.innerHeight+2*e.maxParticipantHeight+20);var v=e.participant[t-1].width,p=i[e.participant[t-1].name+"_"+e.participant[t-1].name];p&&v/2<p&&(v=v/2+p),e.width=Math.ceil(e.participant[t-1].x+v+d)}(i),te(i),function(e){for(var t=[],i=0;i<e.lines.length;i++){var a=e.lines[i];if(0<a.active.length)for(var o=0;o<a.active.length;o++){var l=ye(a,t,o,e);void 0!==l&&e.activeLines.push(l)}else ge(a,t)}e.activeLines.reverse()}(i),this.canvas.width=i.width,this.canvas.height=i.height,o.translate(.5,.5),le(o,i),null!=i.tranlateX&&o.translate(i.tranlateX,.5),ne(o,i),function(e,t){for(var i=t.lines.length,a=0;a<i;a++){var o=t.lines[a];o.type!=M&&o.type!=I||Z(e,o)}}(o,i),re(o,i),he(o,i),this.img.src=this.canvas.toDataURL(),""},NutUml.prototype.analysis=function(t){let i=0,a=[];for(var o=!1,l=!1;i<t.length;){if(V.includes(t[i])&&1==o&&(o=!(l=!0),i++),l){for(var n="",r=!0;i<t.length;)if(r)if(me(t[i])){let e=""+t[i++];for(;i<t.length&&me(t[i]);)e+=t[i++];if("end"==e){l=!1,a.push({type:S,value:n.trimEnd()}),a.push({type:1,value:e});break}n+=e,r=!1}else n+=t[i++];else V.includes(t[i])&&(r=!0),n+=t[i++];l=!1}if(/\s/.test(t[i]))i++;else if(me(t[i])){let e=""+t[i++];for(;i<t.length&&me(t[i]);)e+=t[i++];if(U.includes(e)){if(a.push({type:1,value:e}),j.includes(e)&&"end"!=a[a.length-2].value&&(o=!0),D.includes(e)){for(;i<t.length&&/\s/.test(t[i])&&!V.includes(t[i]);)i++;for(var h="";i<t.length&&!V.includes(t[i]);)h+=t[i++],o=!1;a.push({type:S,value:h})}}else a.push({type:O,value:e})}else if(e.includes(t[i])){o=!1,a.push({type:5,value:t[i++]});let e="";for(;i<t.length&&" "==t[i];)i++;for(;i<t.length&&!V.includes(t[i]);)e+=t[i++];e=e.replace(/\\n/g,"\n"),a.push({type:S,value:e})}else if(","==t[i])a.push({type:H,value:t[i++]});else if("."==t[i]){n="";if(!(i+2<t.length&&"."==t[i+1]&&"."==t[i+2]))return"syntax error";for(i+=3;i<t.length;){if("."==t[i]&&i+2<t.length&&"."==t[i+1]&&"."==t[i+2]){i+=3;break}if("\n"==t[i])break;n+=t[i++]}a.push({type:9,value:n})}else if("|"==t[i]){n="";if(i+2<t.length&&"|"==t[i+1]&&"|"==t[i+2])i+=3;else{if(!(i+1<t.length&&"|"==t[i+1]))return"syntax error";for(i+=2;i<t.length;){if("|"==t[i]&&i+1<t.length&&"|"==t[i+1]){i+=2;break}if("\n"==t[i])break;n+=t[i++]}}a.push({type:10,value:n})}else if(G.includes(t[i])){let e=""+t[i++];for(;i<t.length&&G.includes(t[i]);)e+=t[i++];a.push({type:4,value:e})}else if('"'==t[i]){let e="";for(i++;i<t.length;){if('"'==(s=t[i++]))break;e+=s}e=e.replace("\\n","\n"),a.push({type:6,value:e})}else{if("="!=t[i])return"syntax error："+t[i];if(i++,"="!=t[i])return"syntax error";var s,n="";for(i++;i<t.length;){if("="==(s=t[i++])&&i<t.length&&"="==t[i]){i++;break}n+=s}a.push({type:7,value:n})}}return this.tokens=a,a}}(),"undefined"!=typeof module&&"object"==typeof exports&&(module.exports=NutUml);